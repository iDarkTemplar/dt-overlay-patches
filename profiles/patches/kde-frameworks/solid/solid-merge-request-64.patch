From 22334d7f23fa84f63201ebbe6ea47736f9c0b8f9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?M=C3=A9ven=20Car?= <meven29@gmail.com>
Date: Sat, 18 Dec 2021 09:37:05 +0100
Subject: [PATCH] udisks backend: don't assume /etc/mtab is not present

---
 src/solid/devices/backends/udisks2/udisksstorageaccess.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/solid/devices/backends/udisks2/udisksstorageaccess.cpp b/src/solid/devices/backends/udisks2/udisksstorageaccess.cpp
index 3554ecc..a708ad1 100644
--- a/src/solid/devices/backends/udisks2/udisksstorageaccess.cpp
+++ b/src/solid/devices/backends/udisks2/udisksstorageaccess.cpp
@@ -83,8 +83,8 @@ static QString baseMountPoint(const QByteArray &dev)
     // UDisks "MountPoints" property contains multiple paths, this happens with
     // devices with bind mounts; try finding the "base" mount point
     if (struct libmnt_table *table = mnt_new_table()) {
-        // This parses "/proc/self/mountinfo" by default
-        if (mnt_table_parse_mtab(table, nullptr) == 0) {
+        // This parses "/etc/mtab" if present or "/proc/self/mountinfo" by default
+        if (mnt_table_parse_mtab(table, "/proc/self/mountinfo") == 0) {
             // BACKWARD because the fs's we're interested in, /dev/sdXY, are typically at the end
             struct libmnt_iter *itr = mnt_new_iter(MNT_ITER_BACKWARD);
             struct libmnt_fs *fs;
-- 
GitLab

